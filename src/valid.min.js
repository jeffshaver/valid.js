/* valid.js | Copyright 2014 Jeffrey E. Shaver II | Released under the MIT license | https://github.com/jeffshaver/valid.js/blob/master/LICENSE */

!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.valid=t()}(this,function(e){"use strict";return function(){var t,a,l=[],n=/^[><=]+\d+$/,i={events:["keyup","change"],defaultDateFormat:"mm/dd/yyyy",validFieldClass:"valid-field",invalidFieldClass:"invalid-field",validFormClass:"valid-form",invalidFormClass:"invalid-form",keyUpDelay:200,emailRegex:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i},r={},o=["[data-valid-empty]","[data-valid-length]","[data-valid-date]","[data-valid-dateBefore]","[data-valid-dateAfter]","[data-valid-email]"],d=o.join(", "),s={emptyCheck:["text","textarea","radio","checkbox","select"],lengthCheck:["text","textarea","checkbox","select"],dateCheck:["text"],dateBeforeCheck:["text"],dateAfterCheck:["text"],emailCheck:["text"]},c=function(){return Array.prototype.slice.apply(arguments[0],Array.prototype.slice.call(arguments,1))},u=function(){return Array.prototype.splice.apply(arguments[0],c(arguments,1)),arguments[0]},m=function(e,t){var a,l,n,i=e.className;for("Array"!==D("classNames")&&(t=t.split(" ")),l=0;l<t.length;l++)n=t[l],a=new RegExp("(^|\\s)"+n+"($|\\s)"),a.test(i)||(i+=""!==i?" "+n:n);e.className=i},f=function(e,t){var a,l,n,i=e.className;for("Array"!==D(t)&&(t=t.split(" ")),l=0;l<t.length;l++)n=t[l],a=new RegExp("(^|\\s)"+n+"($|\\s)"),a.test(i)&&(i=i.replace(a,""));e.className=i},h=function(e,t,a,l){var n=a.element;return"Boolean"!==D(e)?(console.error(e+" is not a valid value for the isValid variable."),!1):(e?(b(t,n),r.onFieldValid&&!l&&r.onFieldValid.call(n)):(N(t,n),r.onFieldInvalid&&!l&&r.onFieldInvalid.call(n)),r.onFieldValidityChange&&!l&&r.onFieldValidityChange.call(n,e),a.isValid=e,m(n,r[(e===!0?"valid":"invalid")+"FieldClass"]),void f(n,r[(e===!0?"invalid":"valid")+"FieldClass"]))},v=function(e,t){var a=t.form;return"Boolean"!==D(e)?(console.error(e+" is not a valid value for the isValid variable."),!1):(r.onFormValid&&r.onFormValid.call(a),r.onFormValidityChange&&r.onFormValidityChange.call(a,e),t.isValid=e,m(a,r[(e===!0?"valid":"invalid")+"FormClass"]),void f(a,r[(e===!0?"invalid":"valid")+"FormClass"]))},g=function(e,t,a){var l,n;for(n=0;n<a.length;n++)l=S(t.form,a[n]),h(e,t,l,!0)},p=function(e){var t,a,l,n,i,r,o,m,f=[],h=e.querySelectorAll(d);for(t=0;t<h.length;t++){for(l=h[t],o={element:l,isText:"text"===l.type,isTextarea:"TEXTAREA"===l.tagName,isCheckbox:"checkbox"===l.type,isRadio:"radio"===l.type,isDate:"date"===l.type,isSelect:"SELECT"===l.tagName,isValid:null},(o.isCheckbox||o.isRadio)&&(m=c(e.querySelectorAll('[name="'+l.getAttribute("name")+'"]'),0),o.relatedElements=u(m,m.indexOf(l),1)),a=0;a<O.length;a++)n=O[a].selector,r=O[a].checkName,i=l.getAttribute(n),""===i&&(i=!0),i&&-1===s[r].indexOf(o.isSelect||o.isTextarea?l.tagName.toLowerCase():l.type)?console.error("A "+r+" cannot be applied to a(n) "+(o.isSelect?l.tagName.toLowerCase():l.type)+" element. Skipping element"):o[r]=null!==i?i:!1;f.push(o)}return{form:e,elements:f,validElements:[],invalidElements:[],isValid:null}},y=function(e){return!e||0===e.length},k=function(e){var t,a=this,l=a.checked;if(!e.isCheckbox&&!e.isRadio)return!y(a.value);if(!l)for(t=0;t<e.relatedElements.length;t++)if(e.relatedElements[t].checked===!0){l=!0;break}return l},C=function(e){return n.test(e)},x=function(e,t,a){var l,n,i,r=this,o=/\|\||&&/,d=a.split(o);if(!d.reduce(function(e,t){return e&&C(t)},!0))return!1;if(e.isCheckbox||e.isRadio)for(r.checked&&n++,l=0;l<e.relatedElements.length;l++)e.relatedElements[l].checked&&n++;else n=e.isSelect?r.selectedOptions.length:r.value.length;return i=n+a.replace(o,function(e){return e+n}),new Function("return "+i)()},E=function(e,t,a){var l,n,i,o,d,s,c,u=this.value;for(a=a&&a!==!0?a:r.defaultDateFormat,l=/[^mdy]/.exec(a)[0],n=a.split(l),i=u.split(l),c=0;c<n.length;c++)/m/.test(n[c])&&(o=i[c]),/d/.test(n[c])&&(d=i[c]),/y/.test(n[c])&&(s=i[c]);return o>0&&13>o&&s&&4===s.length&&d>0&&d<=new Date(s,o,0).getDate()},F=function(t,a,l){var n=e.getElementById(l),i=n?n.value:l;return E.call(this)&&E.call(n)?new Date(this.value)-new Date(i)>0?!0:!1:!1},A=function(t,a,l){var n=e.getElementById(l),i=n?n.value:l;return E.call(this)&&E.call(n)?new Date(i)-new Date(this.value)>0?!0:!1:!1},V=function(){return r.emailRegex.test(this.value)},b=function(e,t){var a=e.invalidElements.indexOf(t);-1===e.validElements.indexOf(t)&&e.validElements.push(t),-1!==a&&e.invalidElements.splice(a,1)},N=function(e,t){var a=e.validElements.indexOf(t);-1===e.invalidElements.indexOf(t)&&e.invalidElements.push(t),-1!==a&&e.validElements.splice(a,1)},w=function(e){var t;for(t=0;t<l.length;t++)if(l[t].form===e)return l[t];return null},S=function(e,t){var a,l=w(e).elements;for(a=0;a<l.length&&l[a].element!==t;a++);return l[a]},D=function(e){return Object.prototype.toString.call(e).replace(/^\[\w*\s|\]/g,"")},R=function(){var e,t,a,l,n,i,r,o,d,s=arguments[0]||{},c=1,u=arguments.length,m=!1;for("boolean"==typeof s&&(m=s,s=arguments[1]||{},r=D(s),c=2),"object"!=typeof s&&"Function"!==r&&(s={});u>c;c++)if(e=arguments[c],null!=e){"string"==typeof e&&(e=e.split(""));for(t in e)a=s[t],o=D(a),l=e[t],d=D(l),s!==l&&(m&&l&&("Object"===d||(n="Array"===d))?(n?(n=!1,i=a&&"Array"===o?a:[]):i=a&&"Object"===o?a:{},s[t]=R(m,i,l)):"undefined"!=typeof l&&(s[t]=l))}return s},O=[{checkName:"emptyCheck",selector:"data-valid-empty",method:k},{checkName:"lengthCheck",selector:"data-valid-length",method:x},{checkName:"dateCheck",selector:"data-valid-date",method:E},{checkName:"dateAfterCheck",selector:"data-valid-dateAfter",method:F},{checkName:"dateBeforeCheck",selector:"data-valid-dateBefore",method:A},{checkName:"emailCheck",selector:"data-valid-email",method:V}],j=function(e){var t,a=e.target,l=w(a),n=l.elements;for(a.reset(),l.isValid=null,r.onFormValidityChange&&r.onFormValidityChange.call(a,!1),f(a,[r.validFormClass,r.invalidFormClass]),t=0;t<n.length;t++)n[t].isValid=null,f(n[t].element,[r.validFieldClass,r.invalidFieldClass])},B=function(a){clearTimeout(t),t=setTimeout(function(){T.call(e,a)},r.keyUpDelay)},T=function(t){var a,n,i,r,o,d,s,c,u=t.target,m=!0;for(a=0;a<l.length;a++){for(n=0;n<l[a].elements.length;n++)if(l[a].elements[n].element===u){r=l[a],o=l[a].elements[n],d=r.isValid,s=o.isValid;break}if(o)break}if(o){for(a=0;a<O.length&&m;a++)if(i=O[a],o[i.checkName]){m=i.method.call(u,o,r,o[i.checkName]);try{for(c=e.querySelectorAll('[data-valid-dateAfter="'+u.id+'"], [data-valid-dateBefore="'+u.id+'"]'),n=0;n<c.length;n++)t.stop||T.call(e,{target:c[n],stop:!0})}catch(c){}}m&&!o.isValid?(h(m,r,o),o.relatedElements&&g(m,r,o.relatedElements)):!m&&o.isValid&&(h(m,r,o),o.relatedElements&&g(m,r,o.relatedElements)),r.validElements.length!==r.elements.length||r.isValid?r.validElements.length!==r.elements.length&&r.isValid&&v(!1,r):v(!0,r)}},I=function(){};return I.prototype={init:function(t){if(!a){var n,o=e.querySelectorAll("[data-valid-form]");for(R(r,i,t),n=0;n<o.length;n++)l.push(p(o[n]));for(n=0;n<r.events.length;n++)"keyup"!==r.events[n]?e.addEventListener(r.events[n],T,!1):e.addEventListener(r.events[n],B,!1);return e.addEventListener("reset",j,!1),r.onInit&&r.onInit.call(this,l,r),a=!0}return console.error("You cannot re-initialize valid.js. If you need to re-run, try using the refresh method"),!1},refresh:function(){if(!a)return console.error("You must initialize valid.js first! Try running .init()"),!1;l=[];var t,n=e.querySelectorAll("[data-valid-form]");for(t=0;t<n.length;t++)l.push(p(n[t]));return r.onRefresh&&r.onRefresh.call(this,l,r),!0},addValidationMethod:function(e,t,a){o.push(t),d=o.join(", "),O.push({checkName:e,selector:t.replace(/\[|\]/g,""),method:a})}},new I}}(document));